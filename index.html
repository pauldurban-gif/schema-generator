<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schema Markup Generator | Filament</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0a0a14;
      color: #e8e8e8;
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    h1 {
      font-size: 2.5em;
      background: linear-gradient(135deg, #19e5af, #16c79a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
      text-align: center;
    }
    .subtitle { text-align: center; color: #a0a0a0; margin-bottom: 40px; }
    .card {
      background: #1a1a2e;
      border: 1px solid #2a2a3e;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }
    h2 { color: #16c79a; margin-bottom: 20px; }
    label {
      display: block;
      margin-bottom: 8px;
      color: #16c79a;
      font-weight: 600;
      font-size: 0.9em;
    }
    input, select {
      width: 100%;
      padding: 12px;
      background: #16161f;
      border: 1px solid #2a2a3e;
      border-radius: 6px;
      color: #e8e8e8;
      font-size: 1em;
      margin-bottom: 20px;
    }
    .schema-types {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    .schema-type-btn {
      padding: 12px;
      background: #16161f;
      border: 1px solid #2a2a3e;
      border-radius: 6px;
      color: #a0a0a0;
      cursor: pointer;
      font-size: 0.9em;
    }
    .schema-type-btn.active {
      background: #16c79a;
      color: #1a1a2e;
      border-color: #16c79a;
    }
    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #16c79a, #19e5af);
      border: none;
      border-radius: 8px;
      color: #1a1a2e;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
    }
    .btn:disabled {
      background: #2a2a3e;
      color: #666;
      cursor: not-allowed;
    }
    .loading {
      text-align: center;
      padding: 40px;
      background: #1a1a2e;
      border: 2px solid #16c79a;
      border-radius: 12px;
      margin-top: 20px;
    }
    .loading-icon { 
      font-size: 2em; 
      margin-bottom: 15px;
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }
    .progress-container {
      width: 100%;
      max-width: 400px;
      height: 8px;
      background: #2a2a3e;
      border-radius: 4px;
      margin: 20px auto;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #16c79a, #19e5af);
      border-radius: 4px;
      transition: width 0.3s ease;
      animation: shimmer 2s infinite;
    }
    @keyframes shimmer {
      0% { background-position: -400px 0; }
      100% { background-position: 400px 0; }
    }
    .loading-steps {
      margin-top: 15px;
      color: #a0a0a0;
      font-size: 0.9em;
    }
    .loading-step {
      padding: 8px 0;
      opacity: 0.5;
      transition: opacity 0.3s;
    }
    .loading-step.active {
      opacity: 1;
      color: #16c79a;
      font-weight: 600;
    }
    .loading-step.complete {
      opacity: 0.7;
      color: #e8e8e8;
    }
    .loading-step.complete::before {
      content: "‚úì ";
      color: #16c79a;
    }
    .preview-card {
      background: linear-gradient(135deg, rgba(15, 52, 96, 0.3), rgba(26, 26, 46, 0.5));
      border: 2px solid #16c79a;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
    }
    .preview-badge {
      display: inline-block;
      background: rgba(22, 199, 154, 0.2);
      color: #16c79a;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      margin-bottom: 15px;
    }
    .preview-title {
      font-size: 1.5em;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .preview-desc {
      color: #a0a0a0;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    .preview-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      padding-top: 15px;
      border-top: 1px solid #2a2a3e;
      font-size: 0.9em;
    }
    .code-box {
      background: #16161f;
      border-radius: 8px;
      padding: 20px;
      max-height: 400px;
      overflow-y: auto;
      position: relative;
      margin-bottom: 20px;
    }
    .copy-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 10px 20px;
      background: #16c79a;
      border: none;
      border-radius: 6px;
      color: #1a1a2e;
      font-weight: 600;
      cursor: pointer;
    }
    pre { margin: 0; white-space: pre-wrap; word-break: break-word; color: #e8e8e8; font-size: 0.9em; }
    .improvement-item {
      padding: 12px;
      margin-bottom: 10px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    .improvement-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      min-width: 18px;
      min-height: 18px;
      margin: 2px 0 0 0;
      cursor: pointer;
      flex-shrink: 0;
    }
    .improvement-item span {
      flex: 1;
      line-height: 1.5;
      display: block;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    .improvement-item.selected {
      background: rgba(22, 199, 154, 0.1);
      border-color: #16c79a;
    }
    .comparison-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .comparison-before {
      opacity: 0.7;
      background: linear-gradient(135deg, rgba(50, 50, 60, 0.3), rgba(40, 40, 50, 0.5));
      border: 1px solid #2a2a3e;
      border-radius: 12px;
      padding: 20px;
    }
    .comparison-after {
      background: linear-gradient(135deg, rgba(15, 52, 96, 0.3), rgba(26, 26, 46, 0.5));
      border: 2px solid #16c79a;
      border-radius: 12px;
      padding: 20px;
    }
    .error {
      background: rgba(255, 70, 70, 0.1);
      border: 1px solid #ff4646;
      border-radius: 8px;
      padding: 15px;
      color: #ff8888;
      margin-top: 20px;
    }
    .download-btns {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
    }
    .download-btn {
      flex: 1;
      padding: 16px;
      background: #16161f;
      border: 1px solid #2a2a3e;
      border-radius: 6px;
      color: #e8e8e8;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
    }
    .download-btn:hover {
      background: #202035;
      border-color: #16c79a;
    }
    .info-section {
      background: #1a1a2e;
      border: 1px solid #2a2a3e;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }
    .info-section h3 {
      color: #16c79a;
      margin-bottom: 15px;
      font-size: 1.3em;
    }
    .info-section p {
      color: #a0a0a0;
      line-height: 1.7;
      margin-bottom: 15px;
    }
    .info-section ul {
      color: #a0a0a0;
      line-height: 1.7;
      margin-left: 20px;
      margin-bottom: 15px;
    }
    .info-section li {
      margin-bottom: 8px;
    }
    .instructions-box {
      background: rgba(22, 199, 154, 0.05);
      border: 1px solid rgba(22, 199, 154, 0.2);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }
    .instructions-box h4 {
      color: #16c79a;
      margin-bottom: 12px;
      font-size: 1.1em;
    }
    .instructions-box ol {
      color: #e8e8e8;
      line-height: 1.7;
      margin-left: 20px;
    }
    .instructions-box li {
      margin-bottom: 10px;
    }
    footer {
      margin-top: 60px;
      padding-top: 30px;
      border-top: 1px solid #2a2a3e;
      text-align: center;
      color: #666;
      font-size: 0.9em;
    }
    footer a {
      color: #16c79a;
      text-decoration: none;
      font-weight: 600;
    }
    footer a:hover {
      text-decoration: underline;
    }
    .collapsible-section {
      margin-bottom: 20px;
    }
    .collapsible-header {
      background: #1a1a2e;
      border: 1px solid #2a2a3e;
      border-radius: 8px;
      padding: 15px 20px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.2s;
    }
    .collapsible-header:hover {
      background: #202035;
    }
    .collapsible-header h3 {
      color: #16c79a;
      margin: 0;
      font-size: 1.1em;
    }
    .collapsible-header .arrow {
      color: #16c79a;
      font-size: 1.2em;
      transition: transform 0.3s;
    }
    .collapsible-header.active .arrow {
      transform: rotate(180deg);
    }
    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    .collapsible-content.active {
      max-height: 2000px;
      transition: max-height 0.5s ease-in;
    }
    .collapsible-inner {
      background: #1a1a2e;
      border: 1px solid #2a2a3e;
      border-top: none;
      border-radius: 0 0 8px 8px;
      padding: 20px;
    }
    details summary {
      cursor: pointer;
      padding: 12px;
      background: #1a1a2e;
      border: 1px solid #2a2a3e;
      border-radius: 6px;
      margin-bottom: 10px;
      color: #16c79a;
      font-weight: 600;
    }
    details summary:hover {
      background: #202035;
    }
    details[open] summary {
      border-radius: 6px 6px 0 0;
      margin-bottom: 0;
    }
    details .details-content {
      padding: 20px;
      background: #1a1a2e;
      border: 1px solid #2a2a3e;
      border-top: none;
      border-radius: 0 0 6px 6px;
    }
    code {
      background: #16161f;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: #16c79a;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Schema Markup Generator</h1>
    <p class="subtitle">Help people find your nonprofit's services, donate, and get involved</p>

    <div class="collapsible-section">
      <div class="collapsible-header" onclick="toggleSection('infoSection')">
        <h3>üìö What is Schema Markup & Why Does It Matter?</h3>
        <span class="arrow">‚ñº</span>
      </div>
      <div id="infoSection" class="collapsible-content">
        <div class="collapsible-inner">
          <h4 style="color: #16c79a; margin-bottom: 12px;">What is Schema Markup?</h4>
          <p style="color: #a0a0a0; line-height: 1.7; margin-bottom: 15px;">
            Schema markup (also called structured data) is code you add to your website that helps search engines and AI models like ChatGPT, Claude, and Perplexity understand your organization's key information. Think of it as a "nutrition label" for your website‚Äîit clearly labels who you are, what services you provide, where you're located, and how people can support your mission.
          </p>
          
          <h4 style="color: #16c79a; margin-bottom: 12px;">Why is it Important for Nonprofits?</h4>
          <p style="color: #a0a0a0; line-height: 1.7; margin-bottom: 12px;">
            When people search for services, volunteer opportunities, or organizations to support, AI models prioritize websites with clear, structured data. Schema markup helps your nonprofit appear in AI-generated answers with:
          </p>
          <ul style="color: #a0a0a0; line-height: 1.7; margin-left: 20px; margin-bottom: 15px;">
            <li style="margin-bottom: 8px;"><strong>Contact Information:</strong> Phone, email, and contact forms appear directly in search results</li>
            <li style="margin-bottom: 8px;"><strong>Services & Programs:</strong> Clear descriptions of who you serve and how you help</li>
            <li style="margin-bottom: 8px;"><strong>Location & Hours:</strong> When and where people can visit or reach you</li>
            <li style="margin-bottom: 8px;"><strong>Donation & Volunteer Info:</strong> Easy pathways for supporters to get involved</li>
            <li style="margin-bottom: 8px;"><strong>Mission & Impact:</strong> What makes your organization unique</li>
            <li style="margin-bottom: 8px;"><strong>Team & Leadership:</strong> Names and roles that build credibility</li>
          </ul>
          <p style="color: #e8e8e8; line-height: 1.7; font-weight: 600;">
            Bottom line: Schema markup makes it easier for people to find your services, donate, volunteer, or get help when they need it.
          </p>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Generate Your Schema</h2>
      
      <div style="padding: 15px; background: rgba(22, 199, 154, 0.05); border-left: 3px solid #16c79a; border-radius: 4px; margin-bottom: 25px;">
        <p style="color: #a0a0a0; line-height: 1.7; margin: 0;">
          <strong style="color: #e8e8e8;">üí° How it works:</strong> This tool automatically scans your website's main pages and extracts text-based information to create schema markup. 
          For best results, make sure important details (mission, services, contact info, programs) are clearly displayed as text in prominent areas‚Äînot just in images, PDFs, or footer sections. 
          <strong style="color: #16c79a;">The generated schema is a starting point that you can manually refine before implementing.</strong>
        </p>
      </div>
      
      <label>Website URL</label>
      <input type="url" id="urlInput" placeholder="yournonprofit.org or https://yournonprofit.org">
      <p style="color: #666; font-size: 0.85em; margin: -15px 0 20px 0;">We'll automatically detect the best schema type for your organization</p>

      <button class="btn" id="generateBtn">Generate Schema Markup</button>
      <p style="color: #666; font-size: 0.85em; margin-top: 10px; text-align: center;">
        Processing typically takes 30-60 seconds. Complex sites may take longer.
      </p>

      <div id="loading" class="loading" style="display:none;">
        <div class="loading-icon">üîç</div>
        <h3 style="color: #16c79a; margin-bottom: 10px;">Analyzing Your Organization's Website</h3>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <div class="loading-steps">
          <div class="loading-step" id="step1">Fetching homepage and mission...</div>
          <div class="loading-step" id="step2">Scanning programs and services...</div>
          <div class="loading-step" id="step3">Finding contact and location info...</div>
          <div class="loading-step" id="step4">Extracting team and leadership...</div>
          <div class="loading-step" id="step5">Generating comprehensive schema...</div>
        </div>
      </div>

      <div id="error" class="error" style="display:none;"></div>
    </div>

    <div id="results" style="display:none;">
      <!-- Initial Results -->
      <div id="initialResults" class="card">
        <h2>Your Search Result Preview</h2>
        <p style="color: #a0a0a0; margin-bottom: 20px;">This is how your page will appear in AI search results:</p>
        
        <div id="preview" class="preview-card"></div>

        <div style="margin-top: 20px; padding: 20px; background: rgba(22, 199, 154, 0.05); border: 1px solid rgba(22, 199, 154, 0.2); border-radius: 8px;">
          <h4 style="color: #16c79a; margin-bottom: 12px;">üìä About Your Results</h4>
          <p style="color: #a0a0a0; line-height: 1.7; margin-bottom: 12px;">
            This schema was created by automatically scanning your website's main pages. While comprehensive, automated tools sometimes miss information that's:
          </p>
          <ul style="color: #a0a0a0; line-height: 1.7; margin-left: 20px; margin-bottom: 12px;">
            <li><strong>In footer or header areas</strong> (common for phone/address)</li>
            <li>Only in images or PDFs (not as text)</li>
            <li>Hidden in expandable menus or tabs</li>
            <li>Behind forms or login pages</li>
            <li>On pages we didn't scan (deep subpages)</li>
          </ul>
          <div style="padding: 15px; background: rgba(22, 199, 154, 0.1); border-left: 3px solid #16c79a; border-radius: 4px; margin-bottom: 12px;">
            <p style="color: #e8e8e8; line-height: 1.7; margin: 0;">
              <strong>‚úèÔ∏è You can edit the schema code!</strong> If the generated schema is missing your phone number, email, address, or other critical details, you can manually add them to the JSON code before implementing it on your site. Look for properties like <code>"telephone"</code>, <code>"email"</code>, or <code>"address"</code> and add the missing values.
            </p>
          </div>
          <p style="color: #a0a0a0; line-height: 1.7; margin-bottom: 0; font-size: 0.9em;">
            <strong>Want a more complete schema next time?</strong> Move critical information (contact details, hours, key services) from footer areas into your main page content where automated tools can more easily find it. This helps both our tool and your website visitors.
          </p>
        </div>

        <h3 style="margin-top: 30px; margin-bottom: 15px;">Generated Schema Code</h3>
        
        <details>
          <summary>üìã View Schema Code</summary>
          <div class="details-content">
            <div style="position: relative;">
              <button class="copy-btn" onclick="copySchema()" style="position: absolute; top: 10px; right: 10px; padding: 10px 20px; background: #16c79a; border: none; borderRadius: 6px; color: #1a1a2e; fontWeight: 600; cursor: pointer;">Copy Code</button>
              <pre id="schemaCode" style="max-height: 400px; overflow-y: auto; margin: 0; padding: 20px; background: #16161f; border-radius: 8px; white-space: pre-wrap; word-break: break-word; color: #e8e8e8; font-size: 0.9em;"></pre>
            </div>
          </div>
        </details>

        <h3 style="margin-bottom: 15px;">Download Your Schema</h3>
        <p style="color: #a0a0a0; margin-bottom: 15px; line-height: 1.6;">
          Both formats contain the same code. Choose based on how you'll use it:
        </p>
        
        <div class="download-btns">
          <button class="download-btn" onclick="downloadJSON()" style="border: 2px solid #16c79a; background: rgba(22, 199, 154, 0.1);">
            <div style="font-weight: 700; margin-bottom: 5px;">üì• Download JSON (Recommended)</div>
            <div style="font-size: 0.85em; color: #a0a0a0;">Use this if your CMS or developer needs a .json file</div>
          </button>
          <button class="download-btn" onclick="downloadTXT()">
            <div style="font-weight: 700; margin-bottom: 5px;">üìÑ Download TXT</div>
            <div style="font-size: 0.85em; color: #a0a0a0;">Use this to copy/paste the code manually</div>
          </button>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: rgba(22, 199, 154, 0.05); border: 1px solid rgba(22, 199, 154, 0.2); border-radius: 8px;">
          <h4 style="color: #16c79a; margin-bottom: 15px;">üìù How to Add Schema to Your Website</h4>
          
          <div style="margin-bottom: 20px;">
            <h5 style="color: #e8e8e8; margin-bottom: 10px;">For Most Websites (HTML/CMS):</h5>
            <ol style="color: #a0a0a0; line-height: 1.8; margin-left: 20px;">
              <li><strong style="color: #e8e8e8;">Copy the code</strong> - Click "View Schema Code" above, then click "Copy Code"</li>
              <li><strong style="color: #e8e8e8;">Find your website's &lt;head&gt; section</strong> - This is in your HTML or theme editor</li>
              <li><strong style="color: #e8e8e8;">Paste the code</strong> - Add it anywhere between <code style="background: #16161f; padding: 2px 6px; border-radius: 3px;">&lt;head&gt;</code> and <code style="background: #16161f; padding: 2px 6px; border-radius: 3px;">&lt;/head&gt;</code> tags</li>
              <li><strong style="color: #e8e8e8;">Save and publish</strong> - Your changes go live</li>
              <li><strong style="color: #e8e8e8;">Test it</strong> - Use <a href="https://validator.schema.org/" target="_blank" style="color: #16c79a; text-decoration: none; font-weight: 600;">Schema Validator</a> to verify</li>
            </ol>
          </div>

          <div style="margin-bottom: 20px; padding: 15px; background: rgba(22, 199, 154, 0.05); border-left: 3px solid #16c79a; border-radius: 4px;">
            <h5 style="color: #e8e8e8; margin-bottom: 10px;">Platform-Specific Instructions:</h5>
            
            <details style="margin-bottom: 10px;">
              <summary style="cursor: pointer; color: #16c79a; font-weight: 600; padding: 8px 0;">WordPress</summary>
              <div style="padding: 10px 0; color: #a0a0a0; line-height: 1.7;">
                <strong>Option 1 - Using a Plugin (Easiest):</strong><br>
                ‚Ä¢ Install "Insert Headers and Footers" or "WPCode" plugin<br>
                ‚Ä¢ Go to plugin settings<br>
                ‚Ä¢ Paste code in "Header Scripts" section<br>
                ‚Ä¢ Save changes<br><br>
                <strong>Option 2 - Theme Editor:</strong><br>
                ‚Ä¢ Go to Appearance ‚Üí Theme File Editor<br>
                ‚Ä¢ Click on <code style="background: #16161f; padding: 2px 6px; border-radius: 3px;">header.php</code><br>
                ‚Ä¢ Paste code before the closing <code style="background: #16161f; padding: 2px 6px; border-radius: 3px;">&lt;/head&gt;</code> tag<br>
                ‚Ä¢ Update file
              </div>
            </details>

            <details style="margin-bottom: 10px;">
              <summary style="cursor: pointer; color: #16c79a; font-weight: 600; padding: 8px 0;">Squarespace</summary>
              <div style="padding: 10px 0; color: #a0a0a0; line-height: 1.7;">
                ‚Ä¢ Go to Settings ‚Üí Advanced ‚Üí Code Injection<br>
                ‚Ä¢ Paste code in "Header" section<br>
                ‚Ä¢ Click Save<br>
                ‚Ä¢ Note: Requires Business plan or higher
              </div>
            </details>

            <details style="margin-bottom: 10px;">
              <summary style="cursor: pointer; color: #16c79a; font-weight: 600; padding: 8px 0;">Wix</summary>
              <div style="padding: 10px 0; color: #a0a0a0; line-height: 1.7;">
                ‚Ä¢ Go to Settings ‚Üí Custom Code<br>
                ‚Ä¢ Click "+ Add Custom Code"<br>
                ‚Ä¢ Name it "Schema Markup"<br>
                ‚Ä¢ Paste code<br>
                ‚Ä¢ Choose "Head" for placement<br>
                ‚Ä¢ Apply to all pages<br>
                ‚Ä¢ Click Apply
              </div>
            </details>

            <details style="margin-bottom: 10px;">
              <summary style="cursor: pointer; color: #16c79a; font-weight: 600; padding: 8px 0;">Shopify</summary>
              <div style="padding: 10px 0; color: #a0a0a0; line-height: 1.7;">
                ‚Ä¢ Go to Online Store ‚Üí Themes<br>
                ‚Ä¢ Click "..." ‚Üí Edit code<br>
                ‚Ä¢ Open <code style="background: #16161f; padding: 2px 6px; border-radius: 3px;">theme.liquid</code><br>
                ‚Ä¢ Paste code before <code style="background: #16161f; padding: 2px 6px; border-radius: 3px;">&lt;/head&gt;</code><br>
                ‚Ä¢ Save
              </div>
            </details>

            <details>
              <summary style="cursor: pointer; color: #16c79a; font-weight: 600; padding: 8px 0;">Webflow</summary>
              <div style="padding: 10px 0; color: #a0a0a0; line-height: 1.7;">
                ‚Ä¢ Go to Project Settings (gear icon)<br>
                ‚Ä¢ Click Custom Code<br>
                ‚Ä¢ Paste code in "Head Code" section<br>
                ‚Ä¢ Save and publish
              </div>
            </details>
          </div>

          <div style="padding: 15px; background: rgba(255, 183, 77, 0.1); border: 1px solid #ffb74d; border-radius: 6px; margin-bottom: 15px;">
            <strong style="color: #ffb74d;">‚ö†Ô∏è Important:</strong>
            <p style="color: #e8e8e8; margin-top: 8px; line-height: 1.6; margin-bottom: 0;">
              Add schema to your <strong>homepage</strong> first. If you serve different programs or locations, you may want customized schema on those pages too.
            </p>
          </div>

          <p style="color: #666; font-size: 0.9em; margin-top: 15px; font-style: italic; margin-bottom: 0;">
            Need help implementing? <a href="https://filamentservices.org" target="_blank" style="color: #16c79a; text-decoration: none;">Contact Filament</a> for assistance.
          </p>
        </div>
      </div>

      <!-- Removed: Updated Results section - feature simplified -->
    </div>

    <footer>
      <p>Schema Markup Generator provided by <a href="https://filamentservices.org" target="_blank" rel="noopener noreferrer">Filament Essential Services</a></p>
      <p style="margin-top: 8px; font-size: 0.85em;">Helping nonprofits increase visibility, attract donors, and connect with the communities they serve</p>
    </footer>
  </div>

  <script>
    let currentState = {
      url: '',
      schemaType: 'auto',
      schema: ''
    };

    // Toggle collapsible sections
    function toggleSection(id) {
      const content = document.getElementById(id);
      const header = content.previousElementSibling;
      content.classList.toggle('active');
      header.classList.toggle('active');
    }

    // Progress animation
    function simulateProgress() {
      const progressBar = document.getElementById('progressBar');
      const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
      
      // Reset
      if (progressBar) progressBar.style.width = '0%';
      steps.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.remove('active', 'complete');
      });

      // Initial scan progress (5 steps)
      setTimeout(() => {
        if (progressBar) progressBar.style.width = '20%';
        document.getElementById('step1')?.classList.add('active');
      }, 500);
      setTimeout(() => {
        document.getElementById('step1')?.classList.replace('active', 'complete');
        document.getElementById('step2')?.classList.add('active');
        if (progressBar) progressBar.style.width = '40%';
      }, 3000);
      setTimeout(() => {
        document.getElementById('step2')?.classList.replace('active', 'complete');
        document.getElementById('step3')?.classList.add('active');
        if (progressBar) progressBar.style.width = '60%';
      }, 6000);
      setTimeout(() => {
        document.getElementById('step3')?.classList.replace('active', 'complete');
        document.getElementById('step4')?.classList.add('active');
        if (progressBar) progressBar.style.width = '80%';
      }, 10000);
      setTimeout(() => {
        document.getElementById('step4')?.classList.replace('active', 'complete');
        document.getElementById('step5')?.classList.add('active');
        if (progressBar) progressBar.style.width = '95%';
      }, 15000);
    }

    // Generate schema
    document.getElementById('generateBtn').addEventListener('click', async () => {
      const url = document.getElementById('urlInput').value.trim();
      if (!url) {
        alert('Please enter a URL');
        return;
      }

      let processedUrl = url;
      if (!processedUrl.match(/^https?:\/\//i)) {
        processedUrl = 'https://' + processedUrl;
      }

      currentState.url = processedUrl;
      currentState.updated = false;

      document.getElementById('generateBtn').disabled = true;
      document.getElementById('loading').style.display = 'block';
      document.getElementById('results').style.display = 'none';
      document.getElementById('error').style.display = 'none';
      simulateProgress();

      // Function to attempt generation
      const attemptGeneration = async (isRetry = false) => {
        if (isRetry) {
          // Update loading message for retry
          document.querySelector('#loading h3').textContent = 'Retrying... This may take a moment';
          simulateProgress(); // Restart progress bar
        }

        try {
          const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url: processedUrl, schemaType: currentState.schemaType })
          });

          const data = await response.json();
          if (!response.ok) throw new Error(data.error);

          currentState.schema = data.schema;
          displayResults();
          
          // Reset loading message
          document.querySelector('#loading h3').textContent = 'Analyzing Your Organization\'s Website';

        } catch (error) {
          // If timeout and this is first attempt, retry once
          if (!isRetry && (error.message.includes('timeout') || error.message.includes('TIMEOUT') || error.message.includes('timed out'))) {
            console.log('Timeout detected, retrying...');
            return await attemptGeneration(true);
          }
          
          // Format error message for display
          let errorMsg = error.message;
          if (errorMsg.includes('timeout') || errorMsg.includes('TIMEOUT')) {
            errorMsg = 'The request timed out. This sometimes happens with complex websites. Please try again - it often works on the second attempt.';
          }
          
          // Otherwise show error
          document.getElementById('error').textContent = errorMsg;
          document.getElementById('error').style.display = 'block';
          document.querySelector('#loading h3').textContent = 'Analyzing Your Organization\'s Website';
        } finally {
          document.getElementById('generateBtn').disabled = false;
          document.getElementById('loading').style.display = 'none';
        }
      };

      await attemptGeneration(false);
    });

    // Display results
    function displayResults() {
      document.getElementById('results').style.display = 'block';
      
      const preview = parseSchema(currentState.schema);
      document.getElementById('preview').innerHTML = renderPreview(preview);
      document.getElementById('schemaCode').textContent = currentState.schema;
    }

    // Parse schema
    function parseSchema(code) {
      try {
        let json = code.trim();
        const start = json.indexOf('{');
        if (start > 0) json = json.substring(start);
        
        let count = 0, end = -1;
        for (let i = 0; i < json.length; i++) {
          if (json[i] === '{') count++;
          if (json[i] === '}' && --count === 0) {
            end = i + 1;
            break;
          }
        }
        if (end > 0) json = json.substring(0, end);

        const schema = JSON.parse(json);
        const actual = schema['@graph'] ? schema['@graph'][0] : schema;

        // Extract email - handle string, array of strings, array of objects, or object
        let email = '';
        if (actual.email) {
          if (typeof actual.email === 'string') {
            email = actual.email;
          } else if (Array.isArray(actual.email)) {
            email = actual.email.map(e => typeof e === 'string' ? e : e.email || e.value || '').filter(Boolean).join(', ');
          } else if (typeof actual.email === 'object') {
            email = actual.email.email || actual.email.value || '';
          }
        }

        // Extract phone - handle string, array of strings, array of objects, or object
        let telephone = '';
        if (actual.telephone) {
          if (typeof actual.telephone === 'string') {
            telephone = actual.telephone;
          } else if (Array.isArray(actual.telephone)) {
            telephone = actual.telephone.map(t => typeof t === 'string' ? t : t.telephone || t.value || '').filter(Boolean).join(', ');
          } else if (typeof actual.telephone === 'object') {
            telephone = actual.telephone.telephone || actual.telephone.value || '';
          }
        }

        // Extract location - handle multiple formats
        let location = '';
        if (actual.location) {
          if (typeof actual.location === 'string') {
            location = actual.location;
          } else if (actual.location.name) {
            location = actual.location.name;
          } else if (actual.location.address) {
            const addr = actual.location.address;
            if (typeof addr === 'string') {
              location = addr;
            } else {
              // Build address from PostalAddress object
              const parts = [
                addr.streetAddress,
                addr.addressLocality,
                addr.addressRegion,
                addr.postalCode
              ].filter(Boolean);
              location = parts.join(', ');
            }
          }
        }
        // Also check for direct address property
        if (!location && actual.address) {
          const addr = actual.address;
          if (typeof addr === 'string') {
            location = addr;
          } else {
            const parts = [
              addr.streetAddress,
              addr.addressLocality,
              addr.addressRegion,
              addr.postalCode
            ].filter(Boolean);
            location = parts.join(', ');
          }
        }

        return {
          type: actual['@type'] || 'Content',
          title: actual.name || actual.headline || 'Organization',
          description: actual.description || 'No description available',
          telephone: telephone,
          email: email,
          location: location,
          url: actual.url
        };
      } catch (e) {
        console.error('Parse error:', e);
        return { type: 'Unknown', title: 'Schema Generated', description: 'Preview unavailable' };
      }
    }

    // Render preview
    function renderPreview(p) {
      let meta = '';
      if (p.telephone) meta += `<span>Phone: ${p.telephone}</span>`;
      if (p.email) meta += `<span>Email: ${p.email}</span>`;
      if (p.location) meta += `<span>Location: ${p.location}</span>`;
      if (p.url) meta += `<span>Website: ${p.url}</span>`;

      return `
        <div class="preview-badge">‚úì Schema: ${p.type}</div>
        <div class="preview-title">${p.title}</div>
        <div class="preview-desc">${p.description}</div>
        ${meta ? `<div class="preview-meta">${meta}</div>` : ''}
      `;
    }

    // Copy to clipboard
    // Copy to clipboard
    function copySchema() {
      navigator.clipboard.writeText(currentState.schema).then(() => alert('Copied!'));
    }

    // Download
    function downloadJSON() {
      const blob = new Blob([currentState.schema], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'schema.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function downloadTXT() {
      const blob = new Blob([currentState.schema], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'schema.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Enter key support
    document.getElementById('urlInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('generateBtn').click();
    });
  </script>
</body>
</html>
